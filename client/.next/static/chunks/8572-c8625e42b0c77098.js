(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8572],{8638:function(e,a,t){"use strict";t.d(a,{Z:function(){return J}});var r=t(85893),c=t(67294),i=t(82268),s=t.n(i),n=t(14477),o=t(9473),l=t(45930),d=t(6154);let m=async e=>{try{let a=await d.Z.post("".concat("http://77.222.53.48:3377/api/","favorite/add"),e,{headers:{"Content-Type":"application/json"},withCredentials:!0});if(200===a.status)return a.data}catch(e){throw e}},h=async e=>{try{let a=await d.Z.delete("".concat("http://77.222.53.48:3377/api/","favorite/del"),{data:e,headers:{"Content-Type":"application/json"},withCredentials:!0});if(200===a.status)return a.data}catch(e){throw e}},u=async e=>{console.log({data:e});try{let a=await d.Z.post("".concat("http://77.222.53.48:3377/api/","cart/item/add"),e,{headers:{"Content-Type":"application/json"},withCredentials:!0});if(200===a.status)return a.data}catch(e){throw e}},C=async e=>{try{let a=await d.Z.delete("".concat("http://77.222.53.48:3377/api/","cart/item/del"),{data:e,headers:{"Content-Type":"application/json"},withCredentials:!0});if(200===a.status)return a.data}catch(e){throw e}};var f=t(82991),g=t(11352),p=t(54357),_=(e,a,t,r,i,s,d,_,I,v)=>{let N=(0,n.T)(),[j,w]=(0,c.useState)(d),[P,S]=(0,c.useState)(_),[x,y]=(0,c.useState)(),{user:O}=(0,o.v9)(e=>e.sessionSlice),Z=async()=>{if(O){w(!j);try{let c=j?h:m,n=await c({id:e,material_name:a,article:t,photo:r,name:i,newPrice:I,price:s,isFavorite:!j,isCart:P});y(n),await N((0,f.j_)()),await N((0,p.qC)(!j))}catch(e){console.log(e)}}else{let a=JSON.parse(localStorage.getItem("favorites"))||[],t=a.includes(e);if(t){let t=a.filter(a=>a!==e);localStorage.setItem("favorites",JSON.stringify(t)),w(!j),await N((0,p.Ou)(t))}else{let t=[...a,e];localStorage.setItem("favorites",JSON.stringify(t)),w(!j),await N((0,p.Ou)(t))}}},F=async()=>{if(O){S(!P);try{let c={id:e,material_name:a,article:t,photo:r,name:i,newPrice:I,price:s,isFavorite:j,isCart:!P};if(P)await C(c),await N((0,g.SM)()),S(!1);else{let e=await u(c),a=e[1];S(a),await N((0,g.SM)())}}catch(e){console.log(e)}}else{let t=JSON.parse(localStorage.getItem("cartItems"))||[],r=t.find(a=>a.id===e);if(r){let a=t.filter(a=>a.id!==e);localStorage.setItem("cartItems",JSON.stringify(a)),S(!P),await N((0,g.gn)(a))}else{let r=[...t,{id:e,material_name:a,in_stock:!!I}];localStorage.setItem("cartItems",JSON.stringify(r)),S(!P),await N((0,g.gn)(r))}}};return(0,c.useEffect)(()=>{if(O){let a=JSON.parse(localStorage.getItem("cartItems"))||[];a.length>0&&Promise.all(a.map(async e=>{let a={id:e.id,material_name:e.material_name};return console.log({cartData:a}),u(a)})).then(()=>{localStorage.removeItem("cartItems"),N((0,g.SM)())}).catch(e=>{console.error("Error while adding item in cart:",e)});let t=async()=>{try{let a=await fetch("http://77.222.53.48:3377/api/cart/cartInCat",{method:"GET",credentials:"include"});if(200===a.status){let t=await a.json(),r=t.includes(e);S(r)}N((0,l.l6)(e))}catch(e){console.log(e)}};t()}else{let a=JSON.parse(localStorage.getItem("cartItems")||"[]");(async function(e){try{await N((0,g.gn)(e))}catch(e){console.error("Error while fetching cart items:",e)}})(a);let t=a.some(a=>a.id===e);S(t)}},[O]),(0,c.useEffect)(()=>{if(O){let a=JSON.parse(localStorage.getItem("favorites"))||[];a.length>0&&Promise.all(a.map(async e=>m({id:e}))).then(()=>{localStorage.removeItem("favorites"),N((0,f.j_)())}).catch(e=>{console.error("Error while adding favorites:",e)});let t=async()=>{try{let a=await fetch("http://77.222.53.48:3377/api/favorite",{method:"GET",credentials:"include"});if(200===a.status){let t=await a.json(),r=t.includes(e);w(r)}N((0,l.mN)(e))}catch(e){console.log(e)}};t()}else{let a=JSON.parse(localStorage.getItem("favorites")||"[]"),t=localStorage.getItem("cartItems");if(null!==t){let e=JSON.parse(t);N((0,g.gn)(e))}N((0,p.Ou)(a));let r=a.includes(e);w(r)}},[O]),{isFavorite:j,isCart:P,favoriteHandler:Z,cartHandler:F,urlName:v}},I=t(93946),v=t(58151),N=t(36111),j=e=>{let{isFavorite:a,onClick:t,itemId:c}=e;return(0,r.jsx)(I.Z,{className:s().IconImage,"aria-label":"Add to favorites",onClick:t,children:a?(0,r.jsx)(N.Z,{className:s().IconImage,style:{color:"rgb(0 0 0 / 70%)"}}):(0,r.jsx)(v.Z,{className:s().IconImage})})},w=t(6965),P=t(13659),S=e=>{let{isCart:a,onClick:t,itemId:c}=e;return(0,r.jsx)(I.Z,{className:s().IconImage,onClick:t,"aria-label":"Add to cart",children:a?(0,r.jsx)(w.Z,{className:s().IconImage,style:{color:"rgb(0 0 0 / 70%)"}}):(0,r.jsx)(P.Z,{className:s().IconImage})})},x=t(11163),y=t(41664),O=t.n(y),Z=t(92077),F=t.n(Z),J=e=>{let{id:a,material_name:t,article:c,photo:i,name:n,price:o,isFavorite:l,isCart:d,newPrice:m,isItemInFavoritesState:h,urlName:u}=e,{isFavorite:C,isCart:f,favoriteHandler:g,cartHandler:p}=_(a,t,c,i,n,o,l,d,m,u),I=(0,x.useRouter)(),v=I.asPath.replace(/^\/catalog|\/\d+$/g,"");return(0,r.jsxs)("div",{className:s().Card,children:["/"===v[0]?(0,r.jsxs)(O(),{href:"/"===I.pathname?"/".concat(u,"/").concat(a):"/catalog".concat(v,"/").concat(a),as:"/"===I.pathname?"/catalog/".concat(u,"/").concat(a):"/catalog".concat(v,"/").concat(a),children:[(0,r.jsx)("span",{className:s().CardMedia,children:(0,r.jsx)("img",{src:"".concat("http://localhost:3377/items/").concat(i),alt:n,className:s().Image})}),(0,r.jsx)("h1",{className:s().NameCard,children:n})]}):(0,r.jsxs)(O(),{href:"/"===I.pathname?"/".concat(u,"/").concat(a):"/catalog".concat(v,"/").concat(a),as:"/"===I.pathname?"/catalog/".concat(u,"/").concat(a):"/catalog/".concat(v,"/").concat(a),children:[(0,r.jsx)("span",{className:s().CardMedia,children:(0,r.jsx)("img",{src:"".concat("http://localhost:3377/items/").concat(i),alt:n,className:s().Image})}),(0,r.jsx)("h1",{className:s().NameCard,children:n})]}),m?(0,r.jsxs)("div",{className:s().CardContent,children:[(0,r.jsxs)("h3",{className:s().NewPrice,children:[F()(m).format("0,0")," ₽"]}),(0,r.jsxs)("h3",{className:s().OldPrice,children:[F()(o).format("0,0")," ₽"]}),(0,r.jsxs)("div",{className:s().Icons,children:[(0,r.jsx)(j,{isFavorite:C,onClick:g,itemId:a}),(0,r.jsx)(S,{isCart:f,onClick:p,itemId:a})]})]}):(0,r.jsxs)("div",{className:s().CardContent,children:[(0,r.jsxs)("h3",{className:s().PriceOne,children:[F()(o).format("0,0")," ₽"]}),(0,r.jsxs)("div",{className:s().Icons,children:[(0,r.jsx)(j,{isFavorite:C,onClick:g,itemId:a}),(0,r.jsx)(S,{isCart:f,onClick:p,itemId:a})]})]})]},a)}},48572:function(e,a,t){"use strict";t.d(a,{Z:function(){return m}});var r=t(85893),c=t(67294),i=t(81135),s=t.n(i),n=t(9473),o=t(14477),l=t(82991),d=t(8638);function m(){var e;let a=(0,n.v9)(e=>e.favouriteSlice.favoriteItemList),{user:t}=(0,n.v9)(e=>e.sessionSlice),i=(0,o.T)(),[m,h]=(0,c.useState)([]);(0,c.useEffect)(()=>{i((0,l.P2)())},[]),(0,c.useEffect)(()=>{let e=JSON.parse(localStorage.getItem("favorites"))||"[]",a=async()=>{let a=[];for(let t of e)try{let e=await fetch("http://77.222.53.48:3377/api/item/"+t,{credentials:"include"});if(200===e.status){let t=await e.json();a.push(t)}else 404===e.status&&console.log("Товар не найден")}catch(e){console.log(e)}h(a)};a()},[]),t||(a=[]);let u=a&&Array.isArray(a)?a.map(e=>(0,r.jsx)(d.Z,{id:e.id,material_name:e.Material.name,article:e.article,photo:e.Photos[0].photo,name:e.name,price:e.price,newPrice:e.new_price,isFavorite:e.isFavorite,isCart:e.isCart},e.id)):null,C=m&&Array.isArray(m)?m.map(e=>(0,r.jsx)(d.Z,{id:e.item.id,material_name:e.item.Material.name,article:e.item.article,photo:e.item.Photos[0].photo,name:e.item.name,price:e.item.price,newPrice:e.item.new_price,isFavorite:e.item.isFavorite,isCart:e.isCart},e.item.id)):null;return(0,r.jsx)(r.Fragment,{children:(null===(e=a)||void 0===e?void 0:e.length)>0?(0,r.jsx)("div",{className:s().ContainerOneCard,children:(0,r.jsx)("div",{className:s().ProductCardsContainer,children:u})}):(null==m?void 0:m.length)>0?(0,r.jsx)("div",{className:s().ContainerOneCard,children:(0,r.jsx)("div",{className:s().ProductCardsContainer,children:C})}):(0,r.jsx)("div",{className:s().infoContainer,children:(0,r.jsx)("p",{className:s().infoP,children:"У вас пока нет товаров в избранном"})})})}},82268:function(e){e.exports={Card:"ProductCard_Card__jOQhm",CardMedia:"ProductCard_CardMedia__9rZlI",Image:"ProductCard_Image__SDc8f",NameCard:"ProductCard_NameCard__hi5AD",CardContent:"ProductCard_CardContent__4sZLG",Price:"ProductCard_Price__v5AwF",OldPrice:"ProductCard_OldPrice__RN8OD",NewPrice:"ProductCard_NewPrice__p3_er",PriceOne:"ProductCard_PriceOne__GM4gL",Icons:"ProductCard_Icons__WehvY",IconImage:"ProductCard_IconImage__8Snbm"}},81135:function(e){e.exports={ContainerOneCard:"Favorites_ContainerOneCard__ia5Jt",ProductCardsContainer:"Favorites_ProductCardsContainer__nQvt3",infoContainer:"Favorites_infoContainer__K_Le0",infoP:"Favorites_infoP__mluPk"}}}]);